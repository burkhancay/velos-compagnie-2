{"ast":null,"code":"import * as Realm from \"realm-web\";\nimport { addUser } from \"../../service\";\nimport { app } from \"../../service/mongoDB-sdk\";\nimport { handleLogin, handleLogout, handleAuthenticationErrors } from \"../../state/actions/authentication\";\n\nconst useAuthentication = dispatch => {\n  function handleUserRegistration(newUser) {\n    const userProfile = {\n      first: newUser.first,\n      last: newUser.last,\n      email: newUser.email,\n      city: newUser.city,\n      country: newUser.country,\n      gender: newUser.gender\n    };\n    return new Promise(resolve => {\n      app.emailPasswordAuth.registerUser(newUser.email, newUser.password).then(() => {\n        const credentials = Realm.Credentials.emailPassword(newUser.email, newUser.password);\n        app.logIn(credentials).then(user => {\n          addUser(userProfile);\n          resolve(user);\n          dispatch(handleLogin(newUser));\n        });\n      }).catch(err => dispatch(handleAuthenticationErrors(err)));\n    });\n  }\n\n  async function handleUserLogout() {\n    var _app$currentUser;\n\n    console.dir(app.currentUser);\n    (_app$currentUser = app.currentUser) === null || _app$currentUser === void 0 ? void 0 : _app$currentUser.logOut().then(() => console.log(\"user successfully log out\")).catch(err => console.log(err));\n  }\n\n  async function handleUserLogin(email, password) {\n    return new Promise(resolve => {\n      app.logIn(Realm.Credentials.emailPassword(email, password)).then(async () => {\n        // verify current user\n        const currentUser = await app.currentUser;\n        resolve(currentUser);\n        dispatch(handleLogin(currentUser)); // retrieve user profile\n        // getUser(currentUser.email)\n        // .then(userProfile => {\n        // dispatch(handleLogin(userProfile))\n        // resolve(currentUser)\n        // })\n      }).catch(err => dispatch(handleAuthenticationErrors(err)));\n    });\n  }\n\n  async function handleAuthentication() {\n    const currentUser = await app.currentUser;\n    dispatch(handleLogin(currentUser)); // getUser(currentUser?.email)\n    // .then(userProfile => !!currentUser && dispatch(handleLogin(userProfile)))\n    // .catch(err => dispatch(handleAuthenticationError(err)))\n  }\n\n  return {\n    handleUserRegistration,\n    handleUserLogout,\n    handleUserLogin,\n    handleAuthentication\n  };\n};\n\nexport default useAuthentication;","map":{"version":3,"sources":["C:/Users/BRKHNCY/Desktop/velos/client/src/lib/hooks/useAuthentication/index.js"],"names":["Realm","addUser","app","handleLogin","handleLogout","handleAuthenticationErrors","useAuthentication","dispatch","handleUserRegistration","newUser","userProfile","first","last","email","city","country","gender","Promise","resolve","emailPasswordAuth","registerUser","password","then","credentials","Credentials","emailPassword","logIn","user","catch","err","handleUserLogout","console","dir","currentUser","logOut","log","handleUserLogin","handleAuthentication"],"mappings":"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","sourcesContent":["import * as Realm from \"realm-web\";\r\nimport { addUser } from \"../../service\";\r\nimport { app } from \"../../service/mongoDB-sdk\";\r\nimport { handleLogin, handleLogout, handleAuthenticationErrors } from \"../../state/actions/authentication\";\r\n\r\n\r\nconst useAuthentication = (dispatch) => {\r\n    function handleUserRegistration(newUser){\r\n        const userProfile = {\r\n            first: newUser.first, \r\n            last: newUser.last,\r\n            email: newUser.email,\r\n            city: newUser.city,\r\n            country: newUser.country,\r\n            gender: newUser.gender\r\n        };\r\n        return new Promise((resolve) => {\r\n            app.emailPasswordAuth\r\n            .registerUser(newUser.email, newUser.password)\r\n            .then(() => {\r\n                const credentials = Realm.Credentials.emailPassword(newUser.email, newUser.password);\r\n                app.logIn(credentials).then((user) => {\r\n                    addUser(userProfile);\r\n                    resolve(user);\r\n                    dispatch(handleLogin(newUser));\r\n                });\r\n            })\r\n            .catch((err) => dispatch(handleAuthenticationErrors(err)));\r\n        });\r\n    }\r\n    async function handleUserLogout(){\r\n        console.dir(app.currentUser);\r\n        app.currentUser?.logOut()\r\n        .then(() => console.log(\"user successfully log out\")\r\n        )\r\n        .catch((err) => console.log(err));\r\n    }\r\n\r\n    async function handleUserLogin(email, password){\r\n        return new Promise((resolve) => {\r\n            app\r\n            .logIn(Realm.Credentials.emailPassword(email, password))\r\n            .then(async () => {\r\n                // verify current user\r\n                const currentUser = await app.currentUser;\r\n\r\n                resolve(currentUser);\r\n                dispatch(handleLogin(currentUser));\r\n                // retrieve user profile\r\n                // getUser(currentUser.email)\r\n                // .then(userProfile => {\r\n                    // dispatch(handleLogin(userProfile))\r\n                    // resolve(currentUser)\r\n                    // })\r\n                })\r\n            .catch((err) => dispatch(handleAuthenticationErrors(err)));\r\n            });\r\n        \r\n    }\r\n\r\n    async function handleAuthentication(){\r\n        const currentUser = await app.currentUser;\r\n        dispatch(handleLogin(currentUser));\r\n        // getUser(currentUser?.email)\r\n        // .then(userProfile => !!currentUser && dispatch(handleLogin(userProfile)))\r\n        // .catch(err => dispatch(handleAuthenticationError(err)))\r\n    }\r\n    return {\r\n        handleUserRegistration, handleUserLogout, handleUserLogin, handleAuthentication\r\n    };\r\n};\r\n\r\nexport default useAuthentication;"]},"metadata":{},"sourceType":"module"}